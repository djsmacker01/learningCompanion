{% extends "base.html" %}

{% block title %}{{ title }} - Learning Companion{% endblock %}

{% block content %}
<div class="topic-form-container">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
            <h1 class="h2 mb-1">
                <i class="fas fa-{{ 'plus' if not topic else 'edit' }} text-primary me-2"></i>{{ title }}
            </h1>
            <p class="text-muted mb-0">
                {% if topic %}
                Update your topic information
                {% else %}
                Create a new study topic
                {% endif %}
            </p>
        </div>
        <a href="{{ url_for('topics.list_topics') }}" class="btn btn-outline-secondary">
            <i class="fas fa-arrow-left me-2"></i>Back to Topics
        </a>
    </div>

    <!-- Form -->
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card shadow-sm border-0">
                <div class="card-body p-4">
                    <form method="POST" novalidate>
                        {{ form.hidden_tag() }}

                        <!-- Title Field -->
                        <div class="mb-4">
                            <label for="{{ form.title.id }}" class="form-label fw-bold">
                                <i class="fas fa-heading me-2 text-primary"></i>Topic Title
                            </label>
                            {{ form.title(class="form-control form-control-lg" + (" is-invalid" if form.title.errors
                            else ""), placeholder="Enter a descriptive title for your topic") }}
                            {% if form.title.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.title.errors %}
                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            <div class="form-text">
                                <i class="fas fa-lightbulb me-1"></i>
                                Choose a clear, descriptive title that helps you identify this topic quickly.
                            </div>
                        </div>

                        <!-- Description Field -->
                        <div class="mb-4">
                            <label for="{{ form.description.id }}" class="form-label fw-bold">
                                <i class="fas fa-align-left me-2 text-primary"></i>Description
                            </label>
                            {{ form.description(class="form-control" + (" is-invalid" if form.description.errors else
                            ""), rows="6", placeholder="Describe what this topic covers, key concepts, or learning
                            objectives...") }}
                            {% if form.description.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.description.errors %}
                                <i class="fas fa-exclamation-circle me-1"></i>{{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                            <div class="form-text">
                                <i class="fas fa-info-circle me-1"></i>
                                Provide a detailed description to help you remember what this topic is about.
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="d-flex justify-content-between align-items-center pt-3 border-top">
                            <a href="{{ url_for('topics.list_topics') }}" class="btn btn-outline-secondary">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            <div>
                                {% if topic %}
                                <a href="{{ url_for('topics.view_topic', topic_id=topic.id) }}"
                                    class="btn btn-outline-primary me-2">
                                    <i class="fas fa-eye me-2"></i>View Topic
                                </a>
                                {% endif %}
                                {{ form.submit(class="btn btn-primary btn-lg") }}
                            </div>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Tips Section -->
            <div class="card mt-4 border-0 bg-light">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-lightbulb text-warning me-2"></i>Tips for Great Topics
                    </h5>
                    <ul class="list-unstyled mb-0">
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Be specific:</strong> Instead of "Math", try "Calculus Derivatives"
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Include context:</strong> "Python Web Development with Flask"
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Add goals:</strong> "Spanish Conversation - Basic Greetings"
                        </li>
                        <li>
                            <i class="fas fa-check text-success me-2"></i>
                            <strong>Use descriptions:</strong> Include key concepts and learning objectives
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Auto-resize textarea
    document.getElementById('{{ form.description.id }}').addEventListener('input', function () {
        this.style.height = 'auto';
        this.style.height = (this.scrollHeight) + 'px';
    });

    // Character counter for description
    document.getElementById('{{ form.description.id }}').addEventListener('input', function () {
        const maxLength = 1000;
        const currentLength = this.value.length;
        const remaining = maxLength - currentLength;

        // Update form text with character count
        const formText = this.parentNode.querySelector('.form-text');
        if (remaining < 100) {
            formText.innerHTML = `<i class="fas fa-info-circle me-1"></i>${remaining} characters remaining`;
            if (remaining < 0) {
                formText.classList.add('text-danger');
            } else {
                formText.classList.remove('text-danger');
            }
        }
    });
</script>
{% endblock %}
