{% extends "base.html" %}

{% block title %}Add Question - {{ quiz.title }}{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="h3 mb-1">Add Question</h1>
                    <p class="text-muted mb-0">Quiz: {{ quiz.title }}</p>
                </div>
                <a href="{{ url_for('quizzes.quiz_detail', quiz_id=quiz.id) }}" class="btn btn-outline-secondary">
                    <i class="fas fa-arrow-left me-1"></i>Back to Quiz
                </a>
            </div>

            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-plus-circle me-2"></i>Question Details
                    </h5>
                </div>
                <div class="card-body">
                    <form method="POST">
                        {{ form.hidden_tag() }}

                        <div class="mb-3">
                            {{ form.question_text.label(class="form-label") }}
                            {{ form.question_text(class="form-control" + (" is-invalid" if form.question_text.errors
                            else "")) }}
                            {% if form.question_text.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.question_text.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    {{ form.question_type.label(class="form-label") }}
                                    {{ form.question_type(class="form-select" + (" is-invalid" if
                                    form.question_type.errors else "")) }}
                                    {% if form.question_type.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.question_type.errors %}
                                        {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    {{ form.points.label(class="form-label") }}
                                    {{ form.points(class="form-control" + (" is-invalid" if form.points.errors else ""))
                                    }}
                                    {% if form.points.errors %}
                                    <div class="invalid-feedback">
                                        {% for error in form.points.errors %}
                                        {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <div class="mb-3">
                            {{ form.correct_answer.label(class="form-label") }}
                            {{ form.correct_answer(class="form-control" + (" is-invalid" if form.correct_answer.errors
                            else "")) }}
                            {% if form.correct_answer.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.correct_answer.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="mb-3">
                            {{ form.explanation.label(class="form-label") }}
                            {{ form.explanation(class="form-control" + (" is-invalid" if form.explanation.errors else
                            "")) }}
                            {% if form.explanation.errors %}
                            <div class="invalid-feedback">
                                {% for error in form.explanation.errors %}
                                {{ error }}
                                {% endfor %}
                            </div>
                            {% endif %}
                        </div>

                        <div class="d-flex justify-content-between">
                            <a href="{{ url_for('quizzes.quiz_detail', quiz_id=quiz.id) }}" class="btn btn-secondary">
                                <i class="fas fa-times me-1"></i>Cancel
                            </a>
                            {{ form.submit(class="btn btn-primary") }}
                        </div>
                    </form>
                </div>
            </div>

            <!-- Question Type Information -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-light">
                    <h6 class="card-title mb-0">
                        <i class="fas fa-info-circle me-2"></i>Question Types
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6 class="text-primary">
                                    <i class="fas fa-list me-1"></i>Multiple Choice
                                </h6>
                                <p class="text-muted small mb-0">Question with multiple answer options. You'll be able
                                    to add options after creating the question.</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-info">
                                    <i class="fas fa-check me-1"></i>True/False
                                </h6>
                                <p class="text-muted small mb-0">Simple true or false question. Enter "True" or "False"
                                    as the correct answer.</p>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <h6 class="text-success">
                                    <i class="fas fa-edit me-1"></i>Fill in the Blank
                                </h6>
                                <p class="text-muted small mb-0">Question where users fill in missing information. Enter
                                    the exact answer expected.</p>
                            </div>
                            <div class="mb-3">
                                <h6 class="text-warning">
                                    <i class="fas fa-lightbulb me-1"></i>Flashcard
                                </h6>
                                <p class="text-muted small mb-0">Study card for memorization. Shows question, then
                                    reveals answer for self-assessment.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const questionTypeSelect = document.getElementById('question_type');
        const correctAnswerField = document.getElementById('correct_answer');
        const explanationField = document.getElementById('explanation');

        function updateFormBasedOnType() {
            const selectedType = questionTypeSelect.value;

            // Update placeholder and help text based on question type
            switch (selectedType) {
                case 'true_false':
                    correctAnswerField.placeholder = 'Enter "True" or "False"';
                    explanationField.placeholder = 'Explain why this statement is true or false...';
                    break;
                case 'fill_blank':
                    correctAnswerField.placeholder = 'Enter the exact answer expected...';
                    explanationField.placeholder = 'Provide additional context or explanation...';
                    break;
                case 'flashcard':
                    correctAnswerField.placeholder = 'Enter the answer that will be revealed...';
                    explanationField.placeholder = 'Add any additional notes or context...';
                    break;
                default: // multiple_choice
                    correctAnswerField.placeholder = 'Enter the correct answer (you\'ll add options next)...';
                    explanationField.placeholder = 'Explain why this is the correct answer...';
            }
        }

        questionTypeSelect.addEventListener('change', updateFormBasedOnType);
        updateFormBasedOnType(); // Initialize
    });
</script>
{% endblock %}