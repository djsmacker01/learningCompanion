{% extends "base.html" %}

{% block title %}GCSE Scheduling Dashboard - Learning Companion{% endblock %}

{% block extra_css %}
<style>
    .scheduling-hero {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        padding: 40px 0;
        margin-bottom: 30px;
        border-radius: 10px;
    }

    .schedule-card {
        transition: transform 0.2s ease-in-out;
        border: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .schedule-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }

    .countdown-urgent {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        color: white;
    }

    .countdown-soon {
        background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
        color: white;
    }

    .countdown-normal {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
    }

    .revision-item {
        border-left: 4px solid #667eea;
        padding: 15px;
        margin-bottom: 10px;
        background: #f8f9fa;
        border-radius: 5px;
    }

    .reminder-badge {
        font-size: 0.85em;
        padding: 5px 10px;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Breadcrumb -->
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{{ url_for('main.dashboard') }}">Dashboard</a></li>
            <li class="breadcrumb-item"><a href="{{ url_for('gcse.gcse_dashboard') }}">GCSE Dashboard</a></li>
            <li class="breadcrumb-item active">Scheduling</li>
        </ol>
    </nav>

    <!-- Hero Section -->
    <div class="scheduling-hero">
        <div class="container">
            <h1><i class="fas fa-calendar-alt me-2"></i>GCSE Scheduling Dashboard</h1>
            <p class="lead mb-0">Smart scheduling for exams and revision - maximize your study efficiency</p>
        </div>
    </div>

    <div class="container">
        <!-- Statistics Cards -->
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card bg-primary text-white">
                    <div class="card-body text-center">
                        <h3>{{ exam_countdowns|length }}</h3>
                        <p class="mb-0">Upcoming Exams</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-success text-white">
                    <div class="card-body text-center">
                        <h3>{{ upcoming_revisions|length }}</h3>
                        <p class="mb-0">Revision Sessions</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-warning text-white">
                    <div class="card-body text-center">
                        <h3>{{ today_schedule|length if today_schedule else 0 }}</h3>
                        <p class="mb-0">Today's Tasks</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card bg-info text-white">
                    <div class="card-body text-center">
                        <h3>{{ upcoming_reminders|length }}</h3>
                        <p class="mb-0">Active Reminders</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Left Column: Exam Countdowns & Today's Schedule -->
            <div class="col-lg-6">
                <!-- Exam Countdowns -->
                <div class="card schedule-card mb-4">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-clock me-2"></i>Exam Countdowns</h5>
                    </div>
                    <div class="card-body">
                        {% if exam_countdowns %}
                        {% for item in exam_countdowns[:5] %}
                        <div class="countdown-{{ item.countdown.status }} p-3 rounded mb-3">
                            <h6 class="mb-1">{{ item.exam.exam_name }}</h6>
                            <div class="d-flex justify-content-between align-items-center">
                                <div>
                                    {% if item.countdown.status == 'today' %}
                                    <strong>EXAM TODAY! üéØ</strong>
                                    {% elif item.countdown.status == 'urgent' %}
                                    <strong>{{ item.countdown.days }} day{{ 's' if item.countdown.days > 1 else '' }}
                                        left ‚è∞</strong>
                                    {% else %}
                                    <span>
                                        {% if item.countdown.months > 0 %}{{ item.countdown.months }}mo {% endif %}
                                        {% if item.countdown.weeks > 0 %}{{ item.countdown.weeks }}wk {% endif %}
                                        {% if item.countdown.days > 0 %}{{ item.countdown.days }}d{% endif %}
                                    </span>
                                    {% endif %}
                                </div>
                                <small>{{ item.exam.exam_date }}</small>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p class="text-muted text-center py-4">
                            <i class="fas fa-calendar-alt fa-3x mb-3 d-block"></i>
                            No exams scheduled yet
                        </p>
                        <div class="text-center">
                            <a href="{{ url_for('gcse.create_exam') }}" class="btn btn-primary">
                                <i class="fas fa-plus me-2"></i>Schedule Your First Exam
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Today's Schedule -->
                <div class="card schedule-card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-tasks me-2"></i>Today's Schedule</h5>
                    </div>
                    <div class="card-body">
                        {% if today_schedule %}
                        {% for task in today_schedule %}
                        <div class="revision-item">
                            <h6>{{ task.subject_name if task.subject_name else 'Study Session' }}</h6>
                            <p class="mb-1 small text-muted">{{ task.description if task.description else 'Revision
                                task' }}</p>
                            <div class="d-flex justify-content-between align-items-center">
                                <small><i class="fas fa-clock me-1"></i>{{ task.duration_minutes if
                                    task.duration_minutes else 60 }} minutes</small>
                                <button class="btn btn-sm btn-success">
                                    <i class="fas fa-check me-1"></i>Complete
                                </button>
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p class="text-muted text-center py-3">No tasks scheduled for today</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Right Column: Revision Schedule & Reminders -->
            <div class="col-lg-6">
                <!-- Upcoming Revision Sessions -->
                <div class="card schedule-card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-book-reader me-2"></i>Upcoming Revision (Next 7 Days)</h5>
                    </div>
                    <div class="card-body">
                        {% if upcoming_revisions %}
                        {% for revision in upcoming_revisions %}
                        <div class="revision-item">
                            <div class="d-flex justify-content-between">
                                <h6 class="mb-1">{{ revision.subject_name if revision.subject_name else 'Revision' }}
                                </h6>
                                <span class="badge bg-info">{{ revision.scheduled_date }}</span>
                            </div>
                            <p class="mb-1 small">{{ revision.topic_name if revision.topic_name else 'General revision'
                                }}</p>
                            <small class="text-muted">
                                <i class="fas fa-clock me-1"></i>{{ revision.duration_minutes if
                                revision.duration_minutes else 60 }} min
                            </small>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p class="text-muted text-center py-3">No revision sessions scheduled</p>
                        <div class="text-center">
                            <a href="{{ url_for('gcse.revision_schedule') }}" class="btn btn-warning">
                                <i class="fas fa-plus me-2"></i>Create Revision Plan
                            </a>
                        </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Study Reminders -->
                <div class="card schedule-card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-bell me-2"></i>Study Reminders</h5>
                    </div>
                    <div class="card-body">
                        {% if upcoming_reminders %}
                        {% for reminder in upcoming_reminders %}
                        <div class="d-flex justify-content-between align-items-center mb-3 p-2 bg-light rounded">
                            <div>
                                <h6 class="mb-0">{{ reminder.title if reminder.title else 'Study Reminder' }}</h6>
                                <small class="text-muted">{{ reminder.reminder_time if reminder.reminder_time else
                                    'Upcoming' }}</small>
                            </div>
                            <span class="reminder-badge badge bg-{{ 'danger' if reminder.is_urgent else 'info' }}">
                                {{ reminder.status if reminder.status else 'Active' }}
                            </span>
                        </div>
                        {% endfor %}
                        {% else %}
                        <p class="text-muted text-center py-3">No active reminders</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mt-4">
            <div class="col-12">
                <h4 class="mb-3"><i class="fas fa-rocket me-2"></i>Quick Actions</h4>
                <div class="row">
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('gcse.create_exam') }}" class="btn btn-outline-primary w-100">
                            <i class="fas fa-calendar-plus d-block fa-2x mb-2"></i>
                            Schedule Exam
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('gcse.revision_schedule') }}" class="btn btn-outline-success w-100">
                            <i class="fas fa-clipboard-list d-block fa-2x mb-2"></i>
                            Revision Plan
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('ai_tutor.tutor_dashboard') }}" class="btn btn-outline-info w-100">
                            <i class="fas fa-robot d-block fa-2x mb-2"></i>
                            AI Study Planner
                        </a>
                    </div>
                    <div class="col-md-3 mb-3">
                        <a href="{{ url_for('gcse.gcse_dashboard') }}" class="btn btn-outline-secondary w-100">
                            <i class="fas fa-arrow-left d-block fa-2x mb-2"></i>
                            Back to Dashboard
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}