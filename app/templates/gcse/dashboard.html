{% extends "base.html" %}

{% block title %}GCSE Dashboard - Learning Companion{% endblock %}

{% block extra_css %}
<style>
    .exam-countdown {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border-radius: 10px;
        padding: 20px;
        margin-bottom: 20px;
    }

    .countdown-urgent {
        background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
        animation: pulse 2s infinite;
    }

    .countdown-soon {
        background: linear-gradient(135deg, #feca57 0%, #ff9ff3 100%);
    }

    .subject-card {
        transition: transform 0.2s ease-in-out;
        border: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .subject-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
    }

    .gcse-badge {
        background: #4CAF50;
        color: white;
        padding: 4px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
    }

    .exam-board-badge {
        background: #2196F3;
        color: white;
        padding: 2px 6px;
        border-radius: 8px;
        font-size: 0.7em;
    }

    @keyframes pulse {
        0% {
            transform: scale(1);
        }

        50% {
            transform: scale(1.05);
        }

        100% {
            transform: scale(1);
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h1><i class="fas fa-graduation-cap me-2"></i>GCSE Dashboard</h1>
                <div>
                    <a href="{{ url_for('gcse.subjects_list') }}" class="btn btn-outline-primary me-2">
                        <i class="fas fa-book me-1"></i>Browse Subjects
                    </a>
                    <a href="{{ url_for('gcse.exams_list') }}" class="btn btn-primary">
                        <i class="fas fa-calendar-alt me-1"></i>My Exams
                    </a>
                </div>
            </div>
        </div>
    </div>

    
    {% if exam_countdowns %}
    <div class="row mb-4">
        <div class="col-12">
            <h3><i class="fas fa-clock me-2"></i>Upcoming Exams</h3>
            <div class="row">
                {% for exam_data in exam_countdowns %}
                <div class="col-md-6 col-lg-4 mb-3">
                    <div
                        class="exam-countdown {{ 'countdown-urgent' if exam_data.countdown.status == 'urgent' else 'countdown-soon' if exam_data.countdown.status == 'soon' else '' }}">
                        <div class="d-flex justify-content-between align-items-start mb-2">
                            <h5 class="mb-0">{{ exam_data.exam.exam_name }}</h5>
                            <span class="exam-board-badge">{{ exam_data.exam.exam_board }}</span>
                        </div>

                        {% if exam_data.countdown.status == 'today' %}
                        <p class="mb-1"><strong>EXAM TODAY!</strong></p>
                        {% elif exam_data.countdown.status == 'urgent' %}
                        <p class="mb-1"><strong>{{ exam_data.countdown.days }} days left</strong></p>
                        {% elif exam_data.countdown.status == 'soon' %}
                        <p class="mb-1">
                            {% if exam_data.countdown.weeks > 0 %}
                            {{ exam_data.countdown.weeks }} week{{ 's' if exam_data.countdown.weeks > 1 else '' }}
                            {% if exam_data.countdown.days > 0 %}
                            {{ exam_data.countdown.days }} day{{ 's' if exam_data.countdown.days > 1 else '' }}
                            {% endif %}
                            {% else %}
                            {{ exam_data.countdown.days }} days left
                            {% endif %}
                        </p>
                        {% else %}
                        <p class="mb-1">
                            {% if exam_data.countdown.months > 0 %}
                            {{ exam_data.countdown.months }} month{{ 's' if exam_data.countdown.months > 1 else '' }}
                            {% if exam_data.countdown.weeks > 0 %}
                            {{ exam_data.countdown.weeks }} week{{ 's' if exam_data.countdown.weeks > 1 else '' }}
                            {% endif %}
                            {% else %}
                            {{ exam_data.countdown.weeks }} week{{ 's' if exam_data.countdown.weeks > 1 else '' }}
                            {% if exam_data.countdown.days > 0 %}
                            {{ exam_data.countdown.days }} day{{ 's' if exam_data.countdown.days > 1 else '' }}
                            {% endif %}
                            {% endif %}
                        </p>
                        {% endif %}

                        <small>
                            Exam Date: {{ exam_data.exam.exam_date }}<br>
                            {% if exam_data.exam.duration_minutes %}
                            Duration: {{ exam_data.exam.duration_minutes }} minutes<br>
                            {% endif %}
                            {% if exam_data.exam.total_marks %}
                            Total Marks: {{ exam_data.exam.total_marks }}
                            {% endif %}
                        </small>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endif %}

    
    <div class="row mb-4">
        <div class="col-12">
            <h3><i class="fas fa-rocket me-2"></i>Quick Actions</h3>
            <div class="row">
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-plus-circle fa-3x text-primary mb-3"></i>
                            <h5 class="card-title">Add Subject</h5>
                            <p class="card-text">Start studying a new GCSE subject</p>
                            <a href="{{ url_for('gcse.subjects_list') }}" class="btn btn-primary">Browse Subjects</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-file-alt fa-3x text-success mb-3"></i>
                            <h5 class="card-title">Past Papers</h5>
                            <p class="card-text">Practice with real GCSE exam questions</p>
                            <a href="{{ url_for('gcse_past_papers.past_papers_list') }}" class="btn btn-success">Start
                                Practice</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-calendar-plus fa-3x text-warning mb-3"></i>
                            <h5 class="card-title">Add Exam</h5>
                            <p class="card-text">Schedule your GCSE exams</p>
                            <a href="{{ url_for('gcse.create_exam') }}" class="btn btn-warning">Add Exam</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-chart-line fa-3x text-info mb-3"></i>
                            <h5 class="card-title">Revision Plan</h5>
                            <p class="card-text">Get your personalized revision schedule</p>
                            <a href="{{ url_for('gcse.revision_schedule') }}" class="btn btn-info">View Plan</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-calculator fa-3x text-secondary mb-3"></i>
                            <h5 class="card-title">Grade Calculator</h5>
                            <p class="card-text">Calculate your predicted grades</p>
                            <a href="{{ url_for('gcse_grading.grade_calculator') }}"
                                class="btn btn-secondary">Calculate</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-calendar-alt fa-3x text-dark mb-3"></i>
                            <h5 class="card-title">Scheduling</h5>
                            <p class="card-text">Manage exams and revision plans</p>
                            <a href="{{ url_for('gcse_scheduling.scheduling_dashboard') }}" class="btn btn-dark">View
                                Schedule</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-brain fa-3x text-purple mb-3"></i>
                            <h5 class="card-title">Study Techniques</h5>
                            <p class="card-text">Learn effective study methods</p>
                            <a href="{{ url_for('gcse_techniques.techniques_dashboard') }}"
                                class="btn btn-purple">Explore Techniques</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-chart-line fa-3x text-success mb-3"></i>
                            <h5 class="card-title">Analytics</h5>
                            <p class="card-text">Track your performance progress</p>
                            <a href="{{ url_for('gcse_analytics.analytics_dashboard') }}" class="btn btn-success">View
                                Analytics</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 col-sm-6 mb-3">
                    <div class="card text-center h-100">
                        <div class="card-body">
                            <i class="fas fa-book fa-3x text-orange mb-3"></i>
                            <h5 class="card-title">Resources</h5>
                            <p class="card-text">Access learning materials and content</p>
                            <a href="{{ url_for('gcse_resources.resources_dashboard') }}" class="btn btn-orange">Browse
                                Resources</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    
    {% if user_gcse_topics %}
    <div class="row mb-4">
        <div class="col-12">
            <h3><i class="fas fa-book-open me-2"></i>My GCSE Subjects</h3>
            <div class="row">
                {% for topic in user_gcse_topics %}
                <div class="col-md-6 col-lg-4 mb-3">
                    <div class="card subject-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h5 class="card-title">{{ topic.title }}</h5>
                                <span class="gcse-badge">GCSE</span>
                            </div>

                            {% if topic.gcse_exam_board %}
                            <span class="exam-board-badge">{{ topic.gcse_exam_board }}</span>
                            {% endif %}

                            <p class="card-text">{{ topic.description[:100] }}{% if topic.description|length > 100
                                %}...{% endif %}</p>

                            <div class="d-flex justify-content-between align-items-center">
                                <small class="text-muted">
                                    Created {{ topic.created_at.strftime('%d %b %Y') if topic.created_at }}
                                </small>
                                <a href="{{ url_for('topics.topic_detail', topic_id=topic.id) }}"
                                    class="btn btn-sm btn-outline-primary">
                                    <i class="fas fa-eye me-1"></i>View
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% else %}
    
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-primary">
                <div class="card-body text-center">
                    <i class="fas fa-graduation-cap fa-4x text-primary mb-3"></i>
                    <h4 class="card-title">Start Your GCSE Journey</h4>
                    <p class="card-text">You haven't added any GCSE subjects yet. Browse our comprehensive list of GCSE
                        subjects and start studying for your exams!</p>
                    <a href="{{ url_for('gcse.subjects_list') }}" class="btn btn-primary btn-lg">
                        <i class="fas fa-search me-2"></i>Browse GCSE Subjects
                    </a>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    
    <div class="row">
        <div class="col-12">
            <h3><i class="fas fa-list me-2"></i>Available GCSE Subjects</h3>
            <div class="row">
                {% for subject in subjects[:8] %}
                <div class="col-md-6 col-lg-3 mb-3">
                    <div class="card subject-card h-100">
                        <div class="card-body">
                            <div class="d-flex justify-content-between align-items-start mb-2">
                                <h6 class="card-title">{{ subject.subject_name }}</h6>
                                <span class="exam-board-badge">{{ subject.exam_board }}</span>
                            </div>

                            <p class="card-text small">
                                Specification: {{ subject.specification_code }}<br>
                                Topics: {{ subject.topics|length }}
                            </p>

                            <a href="{{ url_for('gcse.subject_detail', subject_id=subject.id) }}"
                                class="btn btn-sm btn-outline-primary">
                                <i class="fas fa-info-circle me-1"></i>View Details
                            </a>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>

            {% if subjects|length > 8 %}
            <div class="text-center mt-3">
                <a href="{{ url_for('gcse.subjects_list') }}" class="btn btn-outline-primary">
                    <i class="fas fa-list me-1"></i>View All {{ subjects|length }} Subjects
                </a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
    .btn-purple {
        background-color: #6f42c1;
        border-color: #6f42c1;
        color: white;
    }

    .btn-purple:hover {
        background-color: #5a2d91;
        border-color: #5a2d91;
        color: white;
    }

    .text-purple {
        color: #6f42c1 !important;
    }

    .btn-orange {
        background-color: #fd7e14;
        border-color: #fd7e14;
        color: white;
    }

    .btn-orange:hover {
        background-color: #e8650e;
        border-color: #e8650e;
        color: white;
    }

    .text-orange {
        color: #fd7e14 !important;
    }
</style>

<script>
    // Auto-refresh countdown every minute
    setInterval(function () {
        location.reload();
    }, 60000);

    // Add some interactivity
    document.addEventListener('DOMContentLoaded', function () {
        // Add click handlers for exam countdowns
        const examCountdowns = document.querySelectorAll('.exam-countdown');
        examCountdowns.forEach(function (countdown) {
            countdown.addEventListener('click', function () {
                // Could navigate to exam details or revision plan
                console.log('Exam countdown clicked');
            });
        });
    });
</script>
{% endblock %}