{% extends "base.html" %}

{% block title %}GCSE AI Enhancement - Learning Companion{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Header -->
        <div class="col-12">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-warning text-dark">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-graduation-cap fa-2x me-3"></i>
                        <div>
                            <h2 class="h4 mb-0">GCSE AI Enhancement</h2>
                            <p class="mb-0 opacity-75">Advanced AI features tailored specifically for GCSE success</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <!-- Main GCSE AI Features -->
        <div class="col-lg-8">
            <!-- GCSE Study Plan Generator -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-calendar-alt text-primary me-2"></i>
                        GCSE Study Plan Generator
                    </h5>
                </div>
                <div class="card-body">
                    <form id="gcseStudyPlanForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Subject</label>
                                    <select class="form-select" id="studyPlanSubject" required>
                                        <option value="">Choose a subject...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Exam Board</label>
                                    <select class="form-select" id="studyPlanExamBoard" required>
                                        <option value="">Choose exam board...</option>
                                        <option value="AQA">AQA</option>
                                        <option value="Edexcel">Edexcel</option>
                                        <option value="OCR">OCR</option>
                                        <option value="WJEC">WJEC</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Target Grade</label>
                                    <select class="form-select" id="studyPlanTargetGrade" required>
                                        <option value="">Choose target grade...</option>
                                        <option value="9">Grade 9</option>
                                        <option value="8">Grade 8</option>
                                        <option value="7">Grade 7</option>
                                        <option value="6">Grade 6</option>
                                        <option value="5">Grade 5</option>
                                        <option value="4">Grade 4</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Exam Date</label>
                                    <input type="date" class="form-control" id="studyPlanExamDate" required>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="generateGCSEStudyPlan()">
                            <i class="fas fa-magic me-2"></i>Generate Study Plan
                        </button>
                    </form>

                    <div id="gcseStudyPlanResult" class="mt-3" style="display: none;">
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- GCSE Past Paper Analysis -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-file-alt text-success me-2"></i>
                        Past Paper Analysis
                    </h5>
                </div>
                <div class="card-body">
                    <form id="pastPaperAnalysisForm">
                        <div class="row">
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Subject</label>
                                    <select class="form-select" id="analysisSubject" required>
                                        <option value="">Choose a subject...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Exam Board</label>
                                    <select class="form-select" id="analysisExamBoard" required>
                                        <option value="">Choose exam board...</option>
                                        <option value="AQA">AQA</option>
                                        <option value="Edexcel">Edexcel</option>
                                        <option value="OCR">OCR</option>
                                        <option value="WJEC">WJEC</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label class="form-label">Paper Type</label>
                                    <select class="form-select" id="analysisPaperType">
                                        <option value="recent">Recent Papers</option>
                                        <option value="all">All Papers</option>
                                        <option value="summer">Summer Papers</option>
                                        <option value="winter">Winter Papers</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <button type="button" class="btn btn-success" onclick="analyzeGCSEPastPapers()">
                            <i class="fas fa-chart-bar me-2"></i>Analyze Past Papers
                        </button>
                    </form>

                    <div id="pastPaperAnalysisResult" class="mt-3" style="display: none;">
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>

            <!-- GCSE Grade Boundary Predictions -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-crystal-ball text-warning me-2"></i>
                        Grade Boundary Predictions
                    </h5>
                </div>
                <div class="card-body">
                    <form id="gradeBoundaryForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Subject</label>
                                    <select class="form-select" id="boundarySubject" required>
                                        <option value="">Choose a subject...</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label class="form-label">Exam Board</label>
                                    <select class="form-select" id="boundaryExamBoard" required>
                                        <option value="">Choose exam board...</option>
                                        <option value="AQA">AQA</option>
                                        <option value="Edexcel">Edexcel</option>
                                        <option value="OCR">OCR</option>
                                        <option value="WJEC">WJEC</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Current Performance (JSON format)</label>
                            <textarea class="form-control" id="currentPerformance" rows="3"
                                placeholder='{"current_grade": "5", "average_score": 65, "weak_areas": ["algebra", "geometry"]}'></textarea>
                        </div>
                        <button type="button" class="btn btn-warning" onclick="predictGCSEGradeBoundaries()">
                            <i class="fas fa-calculator me-2"></i>Predict Grade Boundaries
                        </button>
                    </form>

                    <div id="gradeBoundaryResult" class="mt-3" style="display: none;">
                        <!-- Results will be displayed here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- GCSE Quick Actions -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-gradient-primary text-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-bolt me-2"></i>GCSE Quick Actions
                    </h5>
                </div>
                <div class="card-body">
                    <div class="list-group list-group-flush">
                        <a href="#" class="list-group-item list-group-item-action"
                            onclick="showRevisionScheduleGenerator()">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-calendar-check text-primary me-3"></i>
                                <div>
                                    <h6 class="mb-1">Revision Schedule</h6>
                                    <small class="text-muted">Multi-subject revision planning</small>
                                </div>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showExamTechniques()">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-clipboard-list text-success me-3"></i>
                                <div>
                                    <h6 class="mb-1">Exam Techniques</h6>
                                    <small class="text-muted">Subject-specific strategies</small>
                                </div>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action"
                            onclick="showPerformanceGapAnalysis()">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-chart-line text-warning me-3"></i>
                                <div>
                                    <h6 class="mb-1">Performance Analysis</h6>
                                    <small class="text-muted">Identify improvement areas</small>
                                </div>
                            </div>
                        </a>
                        <a href="#" class="list-group-item list-group-item-action" onclick="showPersonalizedContent()">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-user-cog text-info me-3"></i>
                                <div>
                                    <h6 class="mb-1">Personalized Content</h6>
                                    <small class="text-muted">GCSE-specific materials</small>
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

            <!-- GCSE Subjects -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-book me-2"></i>GCSE Subjects
                    </h5>
                </div>
                <div class="card-body">
                    <div id="gcseSubjects">
                        <div class="text-center py-4">
                            <i class="fas fa-spinner fa-spin fa-2x text-muted mb-3"></i>
                            <p class="text-muted">Loading GCSE subjects...</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- GCSE Tips -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-light">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-lightbulb text-warning me-2"></i>
                        GCSE Success Tips
                    </h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h6>Study Planning:</h6>
                        <p class="mb-0">Start revision 12-16 weeks before exams for optimal results.</p>
                    </div>
                    <div class="alert alert-success">
                        <h6>Past Papers:</h6>
                        <p class="mb-0">Practice with at least 5 past papers per subject for familiarity.</p>
                    </div>
                    <div class="alert alert-warning">
                        <h6>Grade Boundaries:</h6>
                        <p class="mb-0">Grade boundaries vary each year - aim for 10% above target grade.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modals -->
<!-- Revision Schedule Generator Modal -->
<div class="modal fade" id="revisionScheduleModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">GCSE Revision Schedule Generator</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="revisionScheduleForm">
                    <div class="mb-3">
                        <label class="form-label">Select Subjects</label>
                        <div id="revisionSubjects">
                            <!-- Subjects will be loaded here -->
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Exam Dates</label>
                        <div id="examDatesInput">
                            <!-- Exam date inputs will be generated here -->
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Target Grades</label>
                        <div id="targetGradesInput">
                            <!-- Target grade inputs will be generated here -->
                        </div>
                    </div>
                </form>
                <div id="revisionScheduleResult" style="display: none;">
                    <!-- Results will be displayed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" onclick="generateGCSERevisionSchedule()">Generate
                    Schedule</button>
            </div>
        </div>
    </div>
</div>

<!-- Exam Techniques Modal -->
<div class="modal fade" id="examTechniquesModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">GCSE Exam Techniques</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="examTechniquesForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Subject</label>
                                <select class="form-select" id="techniquesSubject" required>
                                    <option value="">Choose a subject...</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Exam Board</label>
                                <select class="form-select" id="techniquesExamBoard" required>
                                    <option value="">Choose exam board...</option>
                                    <option value="AQA">AQA</option>
                                    <option value="Edexcel">Edexcel</option>
                                    <option value="OCR">OCR</option>
                                    <option value="WJEC">WJEC</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </form>
                <div id="examTechniquesResult" style="display: none;">
                    <!-- Results will be displayed here -->
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-success" onclick="generateGCSEExamTechniques()">Generate
                    Techniques</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    let availableSubjects = [];

    // Load data on page load
    document.addEventListener('DOMContentLoaded', function () {
        loadGCSESubjects();
    });

    function loadGCSESubjects() {
        fetch('/gcse-ai/api/subjects')
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    console.error('Error loading subjects:', data.error);
                    return;
                }

                availableSubjects = data.subjects;
                populateSubjectDropdowns();
                displaySubjectsList();
            })
            .catch(error => {
                console.error('Error loading subjects:', error);
            });
    }

    function populateSubjectDropdowns() {
        const subjectSelects = document.querySelectorAll('select[id$="Subject"]');
        subjectSelects.forEach(select => {
            select.innerHTML = '<option value="">Choose a subject...</option>';
            availableSubjects.forEach(subject => {
                const option = document.createElement('option');
                option.value = subject.code;
                option.textContent = subject.name;
                select.appendChild(option);
            });
        });
    }

    function displaySubjectsList() {
        const subjectsDiv = document.getElementById('gcseSubjects');
        let html = '<div class="row">';

        availableSubjects.forEach(subject => {
            html += `
                <div class="col-md-6 mb-2">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-book text-primary me-2"></i>
                        <span>${subject.name}</span>
                    </div>
                </div>
            `;
        });

        html += '</div>';
        subjectsDiv.innerHTML = html;
    }

    function generateGCSEStudyPlan() {
        const subject = document.getElementById('studyPlanSubject').value;
        const examBoard = document.getElementById('studyPlanExamBoard').value;
        const targetGrade = document.getElementById('studyPlanTargetGrade').value;
        const examDate = document.getElementById('studyPlanExamDate').value;

        if (!subject || !examBoard || !targetGrade || !examDate) {
            alert('Please fill in all required fields');
            return;
        }

        const resultDiv = document.getElementById('gcseStudyPlanResult');
        resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>Generating GCSE study plan...</div>';
        resultDiv.style.display = 'block';

        const url = `/gcse-ai/api/study-plan?subject=${subject}&exam_board=${examBoard}&target_grade=${targetGrade}&exam_date=${examDate}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6>GCSE Study Plan Generated!</h6>
                            <p>Subject: ${data.subject}</p>
                            <p>Exam Board: ${data.exam_board}</p>
                            <p>Target Grade: ${data.target_grade}</p>
                            <p>Days until exam: ${data.days_until_exam}</p>
                            <pre>${JSON.stringify(data.study_plan, null, 2)}</pre>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultDiv.innerHTML = '<div class="alert alert-danger">Error generating study plan</div>';
            });
    }

    function analyzeGCSEPastPapers() {
        const subject = document.getElementById('analysisSubject').value;
        const examBoard = document.getElementById('analysisExamBoard').value;
        const paperType = document.getElementById('analysisPaperType').value;

        if (!subject || !examBoard) {
            alert('Please select a subject and exam board');
            return;
        }

        const resultDiv = document.getElementById('pastPaperAnalysisResult');
        resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>Analyzing past papers...</div>';
        resultDiv.style.display = 'block';

        const url = `/gcse-ai/api/past-paper-analysis?subject=${subject}&exam_board=${examBoard}&paper_type=${paperType}`;

        fetch(url)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6>Past Paper Analysis Complete!</h6>
                            <p>Subject: ${data.subject}</p>
                            <p>Exam Board: ${data.exam_board}</p>
                            <p>Paper Type: ${data.paper_type}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultDiv.innerHTML = '<div class="alert alert-danger">Error analyzing past papers</div>';
            });
    }

    function predictGCSEGradeBoundaries() {
        const subject = document.getElementById('boundarySubject').value;
        const examBoard = document.getElementById('boundaryExamBoard').value;
        const currentPerformance = document.getElementById('currentPerformance').value;

        if (!subject || !examBoard) {
            alert('Please select a subject and exam board');
            return;
        }

        let performanceData = {};
        try {
            performanceData = JSON.parse(currentPerformance || '{}');
        } catch (e) {
            alert('Invalid JSON format for current performance');
            return;
        }

        const resultDiv = document.getElementById('gradeBoundaryResult');
        resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>Predicting grade boundaries...</div>';
        resultDiv.style.display = 'block';

        fetch(`/gcse-ai/api/grade-boundary-predictions?subject=${subject}&exam_board=${examBoard}`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(performanceData)
        })
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-warning">
                            <h6>Grade Boundary Predictions!</h6>
                            <p>Subject: ${data.subject}</p>
                            <p>Exam Board: ${data.exam_board}</p>
                            <p>Predicted Grade: ${data.predicted_grade}</p>
                            <p>Confidence: ${data.prediction_confidence}%</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultDiv.innerHTML = '<div class="alert alert-danger">Error predicting grade boundaries</div>';
            });
    }

    function showRevisionScheduleGenerator() {
        const modal = new bootstrap.Modal(document.getElementById('revisionScheduleModal'));
        modal.show();
    }

    function showExamTechniques() {
        const modal = new bootstrap.Modal(document.getElementById('examTechniquesModal'));
        modal.show();
    }

    function showPerformanceGapAnalysis() {
        alert('Performance gap analysis feature coming soon!');
    }

    function showPersonalizedContent() {
        alert('Personalized content feature coming soon!');
    }

    function generateGCSERevisionSchedule() {
        alert('Revision schedule generation feature coming soon!');
    }

    function generateGCSEExamTechniques() {
        const subject = document.getElementById('techniquesSubject').value;
        const examBoard = document.getElementById('techniquesExamBoard').value;

        if (!subject || !examBoard) {
            alert('Please select a subject and exam board');
            return;
        }

        const resultDiv = document.getElementById('examTechniquesResult');
        resultDiv.innerHTML = '<div class="alert alert-info"><i class="fas fa-spinner fa-spin me-2"></i>Generating exam techniques...</div>';
        resultDiv.style.display = 'block';

        fetch(`/gcse-ai/api/exam-techniques?subject=${subject}&exam_board=${examBoard}`)
            .then(response => response.json())
            .then(data => {
                if (data.error) {
                    resultDiv.innerHTML = `<div class="alert alert-danger">${data.error}</div>`;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6>Exam Techniques Generated!</h6>
                            <p>Subject: ${data.subject}</p>
                            <p>Exam Board: ${data.exam_board}</p>
                            <pre>${JSON.stringify(data, null, 2)}</pre>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Error:', error);
                resultDiv.innerHTML = '<div class="alert alert-danger">Error generating exam techniques</div>';
            });
    }
</script>
{% endblock %}