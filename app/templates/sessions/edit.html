{% extends "base.html" %}

{% block title %}Edit Session - Learning Companion{% endblock %}

{% block content %}
<div class="container">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            
            <div class="text-center mb-5">
                <h1 class="h2 mb-3">
                    <i class="fas fa-edit text-primary me-2"></i>Edit Study Session
                </h1>
                <p class="text-muted">Update your session details and progress</p>
            </div>

            
            <div class="card border-0 shadow-sm">
                <div class="card-body p-4">
                    <form method="POST">
                        {{ form.hidden_tag() }}
                        
                        <div class="row">
                            
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-medium">
                                    <i class="fas fa-calendar text-primary me-2"></i>Session Date
                                </label>
                                {{ form.session_date(class="form-control form-control-lg") }}
                                {% if form.session_date.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.session_date.errors %}
                                            <div>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>

                            
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-medium">
                                    <i class="fas fa-tag text-primary me-2"></i>Session Type
                                </label>
                                {{ form.session_type(class="form-select form-select-lg") }}
                                {% if form.session_type.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.session_type.errors %}
                                            <div>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        <div class="row">
                            
                            <div class="col-md-6 mb-4">
                                <label class="form-label fw-medium">
                                    <i class="fas fa-clock text-primary me-2"></i>Duration (minutes)
                                </label>
                                {{ form.duration_minutes(class="form-control form-control-lg") }}
                                {% if form.duration_minutes.errors %}
                                    <div class="text-danger small mt-1">
                                        {% for error in form.duration_minutes.errors %}
                                            <div>{{ error }}</div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            </div>
                        </div>

                        
                        <div class="mb-4">
                            <label class="form-label fw-medium">
                                <i class="fas fa-chart-line text-primary me-2"></i>Confidence Levels
                            </label>
                            <div class="row">
                                <div class="col-md-6">
                                    <label class="form-label text-muted">Before Session</label>
                                    <div class="d-flex align-items-center">
                                        {{ form.confidence_before(class="form-range", min="1", max="10") }}
                                        <span class="ms-3 fw-bold text-primary" id="confidence-before-display">{{ form.confidence_before.data or 5 }}</span>
                                    </div>
                                    {% if form.confidence_before.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.confidence_before.errors %}
                                                <div>{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label text-muted">After Session</label>
                                    <div class="d-flex align-items-center">
                                        {{ form.confidence_after(class="form-range", min="1", max="10") }}
                                        <span class="ms-3 fw-bold text-success" id="confidence-after-display">{{ form.confidence_after.data or 5 }}</span>
                                    </div>
                                    {% if form.confidence_after.errors %}
                                        <div class="text-danger small mt-1">
                                            {% for error in form.confidence_after.errors %}
                                                <div>{{ error }}</div>
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="text-center mt-3">
                                <div class="confidence-gain-display">
                                    <span class="badge bg-info fs-6" id="confidence-gain">
                                        {% if form.confidence_after.data and form.confidence_before.data %}
                                            {% set gain = form.confidence_after.data - form.confidence_before.data %}
                                            {% if gain > 0 %}
                                                +{{ gain }} improvement
                                            {% elif gain < 0 %}
                                                {{ gain }} decline
                                            {% else %}
                                                No change
                                            {% endif %}
                                        {% else %}
                                            No change
                                        {% endif %}
                                    </span>
                                </div>
                            </div>
                        </div>

                        
                        <div class="mb-4">
                            <label class="form-label fw-medium">
                                <i class="fas fa-sticky-note text-primary me-2"></i>Session Notes
                            </label>
                            {{ form.notes(class="form-control", rows="4", placeholder="What did you learn? Any insights or challenges?") }}
                            {% if form.notes.errors %}
                                <div class="text-danger small mt-1">
                                    {% for error in form.notes.errors %}
                                        <div>{{ error }}</div>
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>

                        
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('sessions.session_detail', session_id=session.id) }}" 
                               class="btn btn-outline-secondary me-md-2">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                            {{ form.submit(class="btn btn-primary btn-lg") }}
                        </div>
                    </form>
                </div>
            </div>

            
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-light border-0">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-info-circle text-primary me-2"></i>Session Information
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-2">
                                <strong>Session ID:</strong> {{ session.id }}
                            </div>
                            <div class="mb-2">
                                <strong>Topic ID:</strong> {{ session.topic_id }}
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-2">
                                <strong>Created:</strong> {{ session.created_at.strftime('%B %d, %Y at %I:%M %p') }}
                            </div>
                            <div class="mb-2">
                                <strong>Status:</strong> 
                                {% if session.completed %}
                                    <span class="badge bg-success">Completed</span>
                                {% else %}
                                    <span class="badge bg-warning">In Progress</span>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-header bg-light border-0">
                    <h5 class="card-title mb-0 text-danger">
                        <i class="fas fa-exclamation-triangle me-2"></i>Danger Zone
                    </h5>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-3">
                        Once you delete a session, there is no going back. Please be certain.
                    </p>
                    <form method="POST" action="{{ url_for('sessions.delete_session', session_id=session.id) }}" 
                          onsubmit="return confirm('Are you absolutely sure you want to delete this session? This action cannot be undone.')" 
                          class="d-inline">
                        <button type="submit" class="btn btn-danger">
                            <i class="fas fa-trash me-2"></i>Delete Session
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Update confidence displays when sliders change
document.getElementById('confidence_before').addEventListener('input', function() {
    document.getElementById('confidence-before-display').textContent = this.value;
    updateConfidenceGain();
});

document.getElementById('confidence_after').addEventListener('input', function() {
    document.getElementById('confidence-after-display').textContent = this.value;
    updateConfidenceGain();
});

function updateConfidenceGain() {
    const before = parseInt(document.getElementById('confidence_before').value);
    const after = parseInt(document.getElementById('confidence_after').value);
    const gain = after - before;
    
    const gainElement = document.getElementById('confidence-gain');
    gainElement.className = 'badge fs-6';
    
    if (gain > 0) {
        gainElement.className += ' bg-success';
        gainElement.textContent = `+${gain} improvement`;
    } else if (gain < 0) {
        gainElement.className += ' bg-danger';
        gainElement.textContent = `${gain} decline`;
    } else {
        gainElement.className += ' bg-secondary';
        gainElement.textContent = 'No change';
    }
}

// Initialize displays
document.addEventListener('DOMContentLoaded', function() {
    updateConfidenceGain();
});
</script>
{% endblock %}
